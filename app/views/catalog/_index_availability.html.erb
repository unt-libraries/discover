<% items = document[:items_json].nil? ? nil : json_str_to_array(document[:items_json]) %>

<div class="document-metadata row item-availability">
  <table class="table table-striped table-sm result__field result__table">
    <thead>
      <tr>
        <th scope="col" class="blacklight-location result__label">Location</th>
        <th scope="col" class="blacklight-call-number result__label">Call Number</th>
        <th scope="col" class="blacklight-availability result__label">Availability</th>
        <th scope="col" class="blacklight-request result__label d-none">Request</th>
      </tr>
    </thead>
    <tbody>
      <% if items.nil? -%>
        <tr
            data-item-id="<%= document[:id][1..-1] %>"
            data-item-call-number="<%= document[:main_call_number] %>">
          <td class="blacklight-location result__value">Location TBD</td>
          <td class="blacklight-call-number result__value"><%= document[:main_call_number] || 'N/A' %></td>
          <td class="blacklight-availability result__value">Checking availability</td>
          <td class="blacklight-request result__value d-none">Request for pickup</td>
        </tr>
      <% else %>
        <% items.each do |record| %>
          <tr class="item-row"
               data-item-id="<%= record['i'] %>"
               data-item-call-number="<%= record['c'] %>"
               data-item-barcode="<%= record['b'] %>"
               data-item-notes="<%= record['n'] %>"
               data-item-requestability="<%= record['r'] %>">
            <td class="blacklight-location result__value">Location TBD</td>
            <td class="blacklight-call-number result__value"><%= record['c'] || 'N/A' %></td>
            <td class="blacklight-availability result__value">Checking availability</td>
            <td class="blacklight-request result__value d-none">
              <% unless record['r'].nil? %>
                Request from <%= record['r'] %>
              <% end %>
            </td>
            <% unless record['n'].nil? %>
              <td class="blacklight-notes">
                <div class="col result__label">Notes: </div>
                <div class="col result__value">
                  <% record['n'].each do |note| %>
                    <%= note %><br>
                  <% end %>
                </div>
              </td>
            <% end %>
          </tr>
        <% end %>
      <% end %>
    <% if document[:has_more_items] %>
      <tr>
        <td><%= link_to_document document, 'More available', counter: document_counter_with_offset(document_counter) %></td>
      </tr>
    <% end %>
    </tbody>
  </table>
</div>
