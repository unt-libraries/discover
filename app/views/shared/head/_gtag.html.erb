<%# TODO: remove development environment from gtag once alpha is no longer relied upon %>
<% if Rails.env.production? or Rails.env.development? %>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=<%= Rails.application.credentials[Rails.env.to_sym][:google_analytics] %>"></script>
<script>
  var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack || window.msDoNotTrack);
  var respectDnt = (dnt == "1" || dnt == "yes");

  console.log(dnt);

  if (!respectDnt) {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', '<%= Rails.application.credentials[Rails.env.to_sym][:google_analytics] %>',
      { 'anonymize_ip': true,
        'transport_type': 'beacon',
      });
  }

</script>
<% end %>
